local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local espEnabled = true -- Tráº¡ng thÃ¡i báº­t/táº¯t ESP
local hitboxObjects = {} -- LÆ°u cÃ¡c hitbox Ä‘á»ƒ xÃ³a khi cáº§n

-- ğŸ›  HÃ m táº¡o ESP + Hitbox cho má»™t ngÆ°á»i chÆ¡i
local function createESP(player)
    if player == Players.LocalPlayer then return end  -- KhÃ´ng Ã¡p dá»¥ng cho chÃ­nh mÃ¬nh
    local character = player.Character
    if not character then return end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end

    -- Náº¿u ESP Ä‘ang bá»‹ táº¯t, khÃ´ng táº¡o má»›i
    if not espEnabled then return end

    -- ğŸ“Œ **Hiá»ƒn thá»‹ tÃªn trÃªn Ä‘áº§u**
    local Billboard = Instance.new("BillboardGui")
    Billboard.Adornee = humanoidRootPart
    Billboard.Size = UDim2.new(0, 200, 0, 50)
    Billboard.StudsOffset = Vector3.new(0, 2, 0)
    Billboard.AlwaysOnTop = true

    local TextLabel = Instance.new("TextLabel", Billboard)
    TextLabel.Size = UDim2.new(1, 0, 1, 0)
    TextLabel.BackgroundTransparency = 1
    TextLabel.Text = player.Name
    TextLabel.TextColor3 = Color3.fromRGB(255, 0, 0)  -- MÃ u Ä‘á»
    TextLabel.TextScaled = true
    Billboard.Parent = humanoidRootPart

    -- ğŸ“Œ **Má»Ÿ rá»™ng Hitbox (Cáº­p nháº­t liÃªn tá»¥c)**
    local hitboxTask = task.spawn(function()
        while character and character.Parent and espEnabled do
            humanoidRootPart.Size = Vector3.new(10, 10, 10)  -- KÃ­ch thÆ°á»›c lá»›n hÆ¡n
            humanoidRootPart.Transparency = 0.7  -- LÃ m trong suá»‘t nháº¹
            humanoidRootPart.CanCollide = false  -- TrÃ¡nh va cháº¡m lá»—i
            wait(1)  -- Cáº­p nháº­t hitbox má»—i giÃ¢y
        end
    end)

    -- ğŸ“Œ **Táº¡o hiá»‡u á»©ng phÃ¡t sÃ¡ng (Highlight)**
    local highlight = Instance.new("Highlight")
    highlight.Parent = character
    highlight.FillColor = Color3.fromRGB(0, 255, 0)  -- MÃ u xanh lÃ¡
    highlight.FillTransparency = 0.5
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.OutlineTransparency = 0.1

    -- LÆ°u cÃ¡c object Ä‘á»ƒ cÃ³ thá»ƒ xÃ³a sau nÃ y
    hitboxObjects[player] = { Billboard, highlight, hitboxTask }
end

-- ğŸ›  **XÃ³a toÃ n bá»™ ESP + Hitbox**
local function removeESP()
    for _, data in pairs(hitboxObjects) do
        if data[1] then data[1]:Destroy() end  -- XÃ³a Billboard
        if data[2] then data[2]:Destroy() end  -- XÃ³a Highlight
        if data[3] then task.cancel(data[3]) end -- Dá»«ng cáº­p nháº­t hitbox
    end
    hitboxObjects = {}
end

-- ğŸ›  **Tá»± Ä‘á»™ng Ã¡p dá»¥ng ESP cho ngÆ°á»i chÆ¡i Ä‘Ã£ vÃ o trÆ°á»›c**
for _, player in pairs(Players:GetPlayers()) do
    if player.Character then
        createESP(player)
    end
end

-- ğŸ›  **Ãp dá»¥ng ESP cho ngÆ°á»i chÆ¡i má»›i vÃ o**
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        wait(1) -- Äá»£i nhÃ¢n váº­t load
        createESP(player)
    end)
end)

-- ğŸ® **Báº­t/Táº¯t ESP báº±ng phÃ­m "H"**
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.H then
        espEnabled = not espEnabled  -- Äáº£o tráº¡ng thÃ¡i ESP

        if espEnabled then
            print("[âœ…] ESP ÄÃƒ Báº¬T!")
            for _, player in pairs(Players:GetPlayers()) do
                if player.Character then
                    createESP(player)
                end
            end
        else
            print("[âŒ] ESP ÄÃƒ Táº®T!")
            removeESP()
        end
    end
end)
