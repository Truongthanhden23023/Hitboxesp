local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- 🛠 Hàm kiểm tra và tạo ESP + Hitbox
local function createESP(player)
    if player == Players.LocalPlayer then return end  -- Không áp dụng cho chính mình
    player.CharacterAppearanceLoaded:Wait()  -- Đợi nhân vật load xong

    local character = player.Character
    if not character then return end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then
        print("[⚠] Không tìm thấy HumanoidRootPart!")
        return
    end

    -- 🔄 Cập nhật hitbox mỗi giây
    task.spawn(function()
        while character and character.Parent do
            humanoidRootPart.Size = Vector3.new(10, 10, 10)  -- Hitbox mở rộng
            humanoidRootPart.Transparency = 0.7
            humanoidRootPart.CanCollide = false
            wait(1)
        end
    end)

    -- 📌 **Tạo viền hitbox bằng SelectionBox**
    local box = Instance.new("SelectionBox")
    box.Adornee = humanoidRootPart
    box.Color3 = Color3.fromRGB(255, 0, 0)  -- Màu đỏ
    box.LineThickness = 0.05
    box.Parent = humanoidRootPart

    -- 📌 **Hiển thị tên trên đầu**
    local Billboard = Instance.new("BillboardGui")
    Billboard.Adornee = humanoidRootPart
    Billboard.Size = UDim2.new(0, 200, 0, 50)
    Billboard.StudsOffset = Vector3.new(0, 2, 0)
    Billboard.AlwaysOnTop = true

    local TextLabel = Instance.new("TextLabel", Billboard)
    TextLabel.Size = UDim2.new(1, 0, 1, 0)
    TextLabel.BackgroundTransparency = 1
    TextLabel.Text = player.Name
    TextLabel.TextColor3 = Color3.fromRGB(0, 255, 0)  -- Màu xanh lá
    TextLabel.TextScaled = true

    Billboard.Parent = humanoidRootPart
end

-- 🛠 **Áp dụng ESP cho tất cả người chơi**
local function autoApplyESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player.Character then
            createESP(player)  -- Thêm ESP ngay lập tức
        end
    end
end

-- 🚀 **Chạy auto mỗi 5 giây để đảm bảo không bị mất**
task.spawn(function()
    while true do
        autoApplyESP()
        wait(5)  -- Kiểm tra lại mỗi 5 giây
    end
end)

-- 🚀 **Tự động áp dụng ESP cho người chơi mới**
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        wait(1)  -- Chờ nhân vật load
        createESP(player)
    end)
end)
