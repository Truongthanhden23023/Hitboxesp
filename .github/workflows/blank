local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- K√≠ch th∆∞·ªõc c·ªë ƒë·ªãnh c·ªßa ESP & Hitbox
local hitboxSize = 7

-- X√°c ƒë·ªãnh k·∫ª ƒë·ªãch ho·∫∑c ƒë·ªìng ƒë·ªôi
local function isEnemy(player)
    return player.Team ~= LocalPlayer.Team
end

local function createESP(player)
    if player == LocalPlayer then return end -- Kh√¥ng t·∫°o ESP cho ch√≠nh m√¨nh
    player.CharacterAdded:Connect(function(character)
        repeat wait() until character:FindFirstChild("HumanoidRootPart")

        local head = character:FindFirstChild("Head")
        local root = character:FindFirstChild("HumanoidRootPart")
        if not head or not root then return end

        -- X√°c ƒë·ªãnh m√†u s·∫Øc theo team
        local color = isEnemy(player) and Color3.new(1, 0, 0) or Color3.new(0, 0, 1)

        -- üü¢ T·∫°o Name ESP
        local billboard = Instance.new("BillboardGui")
        billboard.Adornee = head
        billboard.Size = UDim2.new(0, 100, 0, 30)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.AlwaysOnTop = true
        billboard.Parent = game.CoreGui

        local textLabel = Instance.new("TextLabel", billboard)
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = player.Name
        textLabel.TextColor3 = color
        textLabel.TextStrokeTransparency = 0.5
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.TextSize = 14
        textLabel.Parent = billboard

        -- üî¥ T·∫°o Box ESP (Highlight)
        local highlight = Instance.new("Highlight")
        highlight.Parent = character
        highlight.FillTransparency = 0.5
        highlight.OutlineColor = color
        highlight.OutlineTransparency = 0

        -- üéØ T·∫°o Hitbox (V√πng va ch·∫°m l·ªõn h∆°n)
        local hitbox = Instance.new("Part")
        hitbox.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize) -- K√≠ch th∆∞·ªõc hitbox c·ªë ƒë·ªãnh
        hitbox.Transparency = 0.7
        hitbox.CanCollide = false
        hitbox.Anchored = true
        hitbox.Color = color
        hitbox.Material = Enum.Material.ForceField
        hitbox.Parent = character

        -- C·∫≠p nh·∫≠t v·ªã tr√≠ hitbox theo nh√¢n v·∫≠t
        RunService.RenderStepped:Connect(function()
            if character and root then
                hitbox.Position = root.Position
            end
        end)

        -- X√≥a ESP khi nh√¢n v·∫≠t ch·∫øt
        player.CharacterRemoving:Connect(function()
            billboard:Destroy()
            highlight:Destroy()
            hitbox:Destroy()
        end)
    end)
end

-- √Åp d·ª•ng ESP cho t·∫•t c·∫£ ng∆∞·ªùi ch∆°i hi·ªán t·∫°i
for _, player in pairs(Players:GetPlayers()) do
    createESP(player)
end

-- √Åp d·ª•ng ESP cho ng∆∞·ªùi ch∆°i m·ªõi v√†o
Players.PlayerAdded:Connect(createESP)
